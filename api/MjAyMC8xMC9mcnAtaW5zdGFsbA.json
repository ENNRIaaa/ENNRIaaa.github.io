{"title":"内网穿透工具-Frp","date":"2020-10-06T09:27:00.000Z","date_formatted":{"ll":"2020年10月6日","L":"2020/10/06","MM-DD":"10-06"},"link":"2020/10/frp-install","tags":["Frp","内网穿透"],"categories":["Tools"],"updated":"2020-10-06T05:57:34.600Z","content":"<p>准备工作：</p>\n<ul>\n<li>具有固定公网IP的主机（我使用的是阿里云的VPS）</li>\n<li>主角：<strong>Frp</strong>工具，<a href=\"https://github.com/fatedier/frp/releases\" target=\"_blank\">点击下载</a></li>\n<li>内网中的主机，也就是我们最终需要在外网访问的内网中的主机</li>\n</ul>\n<hr>\n<h3 id=\"配置服务端（vps中）\">配置服务端（VPS中）<a title=\"#配置服务端（vps中）\" href=\"#配置服务端（vps中）\"></a></h3>\n<p>下载地址：<a href=\"https://github.com/fatedier/frp/releases\" target=\"_blank\">https://github.com/fatedier/frp/releases</a></p>\n<p><strong>下载Frp：</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/fatedier/frp/releases/download/v0.34.0/frp_0.34.0_linux_amd64.tar.gz</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>下载速度不理想可以先下载到本地，再上传到Linux服务器上</em></p>\n<p>1、从服务器上下载文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;scp username@servername:/path/filename /var/www/local_dir（本地目录）</span><br></pre></td></tr></table></figure>\n<p>2、上传本地文件到服务器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;scp /path/filename username@servername:/path</span><br></pre></td></tr></table></figure>\n<p>3、从服务器下载整个目录</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;scp -r username@servername:/var/www/remote_dir/（远程目录） /var/www/local_dir（本地目录）</span><br></pre></td></tr></table></figure>\n<p>4、上传目录到服务器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;scp  -r local_dir username@servername:remote_dir</span><br></pre></td></tr></table></figure>\n</blockquote>\n<p><strong>解压：</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf frp_0.34.0_linux_amd64.tar.gz</span><br></pre></td></tr></table></figure>\n<p><strong>进入目录：</strong></p>\n<p><img src=\"https://images.shiguangping.com/imgs/20201006125017.png\" alt=\"image-20201006125017260\" class=\"φcx\"></p>\n<p>目录中主要文件：</p>\n<ul>\n<li>\n<p><code>frps</code>服务端</p>\n</li>\n<li>\n<p><code>frps.ini</code>服务端配置文件</p>\n</li>\n<li>\n<p><code>frpc</code>客户端</p>\n</li>\n<li>\n<p><code>frpc.ini</code>客户端配置文件</p>\n</li>\n</ul>\n<p><strong>修改<code>frps.ini</code>：</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim frps.ini</span><br></pre></td></tr></table></figure>\n<p>配置文件：</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[common]</span></span><br><span class=\"line\"><span class=\"comment\"># 服务端端口号</span></span><br><span class=\"line\"><span class=\"attr\">bind_port</span> = <span class=\"number\">7000</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 如果你想要用 frp 穿透访问内网中的网站（例如路由器设置页面）</span></span><br><span class=\"line\"><span class=\"comment\"># 则必须要设置以下两个监听端口，不设置则不会开启这项功能</span></span><br><span class=\"line\"><span class=\"attr\">vhost_http_port</span> = <span class=\"number\">80</span></span><br><span class=\"line\"><span class=\"attr\">vhost_https_port</span> = <span class=\"number\">443</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 连接认证token(可选)</span></span><br><span class=\"line\"><span class=\"attr\">token</span> = <span class=\"number\">12345678</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 则你将 test.example.com 解析到服务端后，可以使用此域名来访问客户端对应的 http</span></span><br><span class=\"line\"><span class=\"attr\">subdomain_host</span> = liyan.run</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 自定义404 页面，要用绝对路径哦！</span></span><br><span class=\"line\"><span class=\"comment\"># custom_404_page = /root/frp_0.27.0_linux_amd64/404.html</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 仪表盘端口，只有设置了才能使用仪表盘（即后台）</span></span><br><span class=\"line\"><span class=\"attr\">dashboard_port</span> = <span class=\"number\">81</span></span><br><span class=\"line\"><span class=\"comment\"># 仪表盘访问的用户名密码，如果不设置，则默认都是 admin</span></span><br><span class=\"line\"><span class=\"attr\">dashboard_user</span> = admin</span><br><span class=\"line\"><span class=\"attr\">dashboard_pwd</span> = admin</span><br></pre></td></tr></table></figure>\n<p><strong>启动frps：</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">screen -S frps ./frps -c frps.ini</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>安装screen：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;yum install screen</span><br></pre></td></tr></table></figure>\n</blockquote>\n<p>使用快捷键Ctrl+A D(即按住Ctrl，依次再按A,D)，使程序在后台运行。</p>\n<h3 id=\"配置客户端（内网主机）\">配置客户端（内网主机）<a title=\"#配置客户端（内网主机）\" href=\"#配置客户端（内网主机）\"></a></h3>\n<p>在内网主机中下载Frp，或通过本地上传：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/fatedier/frp/releases/download/v0.34.0/frp_0.34.0_linux_amd64.tar.gz</span><br></pre></td></tr></table></figure>\n<p><strong>同服务端操作一样，解压后进入目录：</strong></p>\n<p><strong>修改<code>frpc.ini</code>：</strong></p>\n<p>配置文件：</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[common]</span></span><br><span class=\"line\"><span class=\"comment\"># 服务端ip或域名(域名需要将域名解析到VPS)</span></span><br><span class=\"line\"><span class=\"attr\">server_addr</span> = frp.liyan.run</span><br><span class=\"line\"><span class=\"comment\"># 服务端端口号</span></span><br><span class=\"line\"><span class=\"attr\">server_port</span> = <span class=\"number\">7000</span></span><br><span class=\"line\"><span class=\"comment\"># 服务端设置的token</span></span><br><span class=\"line\"><span class=\"attr\">token</span> = <span class=\"number\">12345678</span></span><br><span class=\"line\"><span class=\"attr\">admin_addr</span> = <span class=\"number\">127.0</span>.<span class=\"number\">0.1</span></span><br><span class=\"line\"><span class=\"attr\">admin_port</span> = <span class=\"number\">7400</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[ssh]</span></span><br><span class=\"line\"><span class=\"attr\">type</span> = tcp</span><br><span class=\"line\"><span class=\"attr\">local_port</span> = <span class=\"number\">22</span></span><br><span class=\"line\"><span class=\"comment\"># 远程访问的端口号</span></span><br><span class=\"line\"><span class=\"attr\">remote_port</span> = <span class=\"number\">6000</span></span><br><span class=\"line\"><span class=\"attr\">use_encryption</span> = <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">use_compression</span> = <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<p><strong>启动frpc：</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">screen -S frpc ./frpc -c frpc.ini</span><br></pre></td></tr></table></figure>\n<h3 id=\"测试\">测试<a title=\"#测试\" href=\"#测试\"></a></h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh -p 6000 liyan@frp.liyan.run</span><br></pre></td></tr></table></figure>\n<p>可以正常登录到内网主机，说明内网穿透成功。</p>\n<hr>\n<p>详细的文档：</p>\n<p>中文：<a href=\"https://gitee.com/dengweiwen/frp\" target=\"_blank\">https://gitee.com/dengweiwen/frp</a></p>\n<p>英文：<a href=\"https://github.com/fatedier/frp\" target=\"_blank\">https://github.com/fatedier/frp</a></p>\n","next":{"title":"Docker安装Jenkins","link":"2020/09/docker-install-jenkins"},"plink":"https://www.shiguangping.com/2020/10/frp-install/","toc":[{"id":"配置服务端（vps中）","title":"配置服务端（VPS中）","index":"1"},{"id":"配置客户端（内网主机）","title":"配置客户端（内网主机）","index":"2"},{"id":"测试","title":"测试","index":"3"}]}