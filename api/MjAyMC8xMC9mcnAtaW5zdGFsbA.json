{"title":"内网穿透工具-Frp","date":"2020-10-06T09:27:00.000Z","date_formatted":{"ll":"2020年10月6日","L":"2020/10/06","MM-DD":"10-06"},"link":"2020/10/frp-install","tags":["Frp","内网穿透"],"categories":["Tools"],"updated":"2020-10-06T12:58:40.927Z","content":"<h1 id=\"准备工作：\">准备工作：<a title=\"#准备工作：\" href=\"#准备工作：\"></a></h1>\n<ul>\n<li>具有固定公网IP的主机（如阿里云、腾讯云主机）</li>\n<li>主角：<strong>Frp</strong>工具，<a href=\"https://github.com/fatedier/frp/releases\" target=\"_blank\">下载页面</a></li>\n<li>内网主机（最终需要在外网访问的内网主机）</li>\n</ul>\n<hr>\n<h1 id=\"配置服务端（vps）\">配置服务端（VPS）<a title=\"#配置服务端（vps）\" href=\"#配置服务端（vps）\"></a></h1>\n<h3 id=\"下载frp\">下载Frp<a title=\"#下载frp\" href=\"#下载frp\"></a></h3>\n<p>Github地址：<a href=\"https://github.com/fatedier/frp/releases\" target=\"_blank\">https://github.com/fatedier/frp/releases</a></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/fatedier/frp/releases/download/v0.34.0/frp_0.34.0_linux_amd64.tar.gz</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><em>下载速度不理想可以先下载到本地，再上传到Linux服务器上</em></p>\n<p>1、从服务器上下载文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;scp username@servername:/path/filename /var/www/local_dir（本地目录）</span><br></pre></td></tr></table></figure>\n<p>2、上传本地文件到服务器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;scp /path/filename username@servername:/path</span><br></pre></td></tr></table></figure>\n<p>3、从服务器下载整个目录</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;scp -r username@servername:/var/www/remote_dir/（远程目录） /var/www/local_dir（本地目录）</span><br></pre></td></tr></table></figure>\n<p>4、上传目录到服务器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;scp  -r local_dir username@servername:remote_dir</span><br></pre></td></tr></table></figure>\n</blockquote>\n<p><strong>解压：</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf frp_0.34.0_linux_amd64.tar.gz</span><br></pre></td></tr></table></figure>\n<p><strong>进入目录：</strong></p>\n<p><img src=\"https://images.shiguangping.com/imgs/20201006125017.png\" alt=\"image-20201006125017260\" class=\"φcx\"></p>\n<p>目录中主要文件：</p>\n<ul>\n<li>\n<p><code>frps</code>：服务端可执行程序</p>\n</li>\n<li>\n<p><code>frps.ini</code>：服务端配置文件</p>\n</li>\n<li>\n<p><code>frps_full.ini</code>：服务端所有配置项</p>\n</li>\n<li>\n<p><code>frpc</code>：客户端可执行程序</p>\n</li>\n<li>\n<p><code>frpc.ini</code>：客户端配置文件</p>\n</li>\n<li>\n<p><code>frpc_full.ini</code>：客户端所有配置项</p>\n</li>\n<li>\n<p><code>LICENSE</code>：许可证</p>\n</li>\n</ul>\n<h3 id=\"编辑frps.ini\">编辑<code>frps.ini</code><a title=\"#编辑frps.ini\" href=\"#编辑frps.ini\"></a></h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim frps.ini</span><br></pre></td></tr></table></figure>\n<p>配置文件：</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[common]</span></span><br><span class=\"line\"><span class=\"comment\"># 服务端端口号</span></span><br><span class=\"line\"><span class=\"comment\"># 用于与客户端进行连接通信</span></span><br><span class=\"line\"><span class=\"attr\">bind_port</span> = <span class=\"number\">7000</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 连接认证token(可选)</span></span><br><span class=\"line\"><span class=\"attr\">token</span> = <span class=\"number\">12345678</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 访问内网主机的web服务时配置（可选）</span></span><br><span class=\"line\"><span class=\"attr\">vhost_http_port</span> = <span class=\"number\">80</span></span><br><span class=\"line\"><span class=\"attr\">vhost_https_port</span> = <span class=\"number\">443</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 仪表盘端口，只有设置了才能使用仪表盘（即后台）</span></span><br><span class=\"line\"><span class=\"attr\">dashboard_port</span> = <span class=\"number\">81</span></span><br><span class=\"line\"><span class=\"comment\"># 仪表盘访问的用户名密码，如果不设置，则默认都是 admin</span></span><br><span class=\"line\"><span class=\"attr\">dashboard_user</span> = admin</span><br><span class=\"line\"><span class=\"attr\">dashboard_pwd</span> = admin</span><br></pre></td></tr></table></figure>\n<h3 id=\"启动frps\">启动frps<a title=\"#启动frps\" href=\"#启动frps\"></a></h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">screen -S frps ./frps -c frps.ini</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>安装screen：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;yum install screen</span><br></pre></td></tr></table></figure>\n</blockquote>\n<p>使用快捷键Ctrl+A D(即按住Ctrl，依次再按A,D)，使程序在后台运行。</p>\n<hr>\n<h1 id=\"配置客户端（内网主机）\">配置客户端（内网主机）<a title=\"#配置客户端（内网主机）\" href=\"#配置客户端（内网主机）\"></a></h1>\n<h3 id=\"下载frp-1\">下载Frp<a title=\"#下载frp-1\" href=\"#下载frp-1\"></a></h3>\n<p>在内网主机中下载Frp，或通过本地上传：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/fatedier/frp/releases/download/v0.34.0/frp_0.34.0_linux_amd64.tar.gz</span><br></pre></td></tr></table></figure>\n<p><strong>同服务端操作一样，解压后进入目录：</strong></p>\n<h3 id=\"编辑frpc.ini\">编辑<code>frpc.ini</code><a title=\"#编辑frpc.ini\" href=\"#编辑frpc.ini\"></a></h3>\n<p>配置文件：</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[common]</span></span><br><span class=\"line\"><span class=\"comment\"># 服务端ip</span></span><br><span class=\"line\"><span class=\"attr\">server_addr</span> = <span class=\"number\">121.197</span>.<span class=\"number\">190.123</span></span><br><span class=\"line\"><span class=\"comment\"># 服务端端口号</span></span><br><span class=\"line\"><span class=\"attr\">server_port</span> = <span class=\"number\">7000</span></span><br><span class=\"line\"><span class=\"comment\"># 服务端设置的token</span></span><br><span class=\"line\"><span class=\"attr\">token</span> = <span class=\"number\">12345678</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[ssh]</span></span><br><span class=\"line\"><span class=\"attr\">type</span> = tcp</span><br><span class=\"line\"><span class=\"comment\"># 本地服务端口号</span></span><br><span class=\"line\"><span class=\"attr\">local_port</span> = <span class=\"number\">22</span></span><br><span class=\"line\"><span class=\"comment\"># 映射到服务端主机的端口号</span></span><br><span class=\"line\"><span class=\"attr\">remote_port</span> = <span class=\"number\">6000</span></span><br><span class=\"line\"><span class=\"comment\"># 加密和压缩</span></span><br><span class=\"line\"><span class=\"attr\">use_encryption</span> = <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">use_compression</span> = <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<p>通过访问<code>远程主机IP:remote_port</code>来访问内网主机的<code>local_port</code>端口的服务。</p>\n<p>例如在外网通过ssh连接到内网主机，<code>ssh -p 6000 121.197.190.123</code>来SSH连接到内网主机，<em>22端口是ssh的默认端口号</em>。</p>\n<h3 id=\"访问内网主机中的其他服务\">访问内网主机中的其他服务<a title=\"#访问内网主机中的其他服务\" href=\"#访问内网主机中的其他服务\"></a></h3>\n<p>对于内网主机上部署了如mysql数据库、redis缓存等服务也可以通过这种方式配置：</p>\n<p>Mysql:</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[mysql]</span></span><br><span class=\"line\"><span class=\"attr\">type</span> = tcp</span><br><span class=\"line\"><span class=\"attr\">local_port</span> = <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">remote_port</span> = <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">use_encryption</span> = <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">use_compression</span> = <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<p>Redis:</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[redis]</span></span><br><span class=\"line\"><span class=\"attr\">type</span> = tcp</span><br><span class=\"line\"><span class=\"attr\">local_port</span> = <span class=\"number\">6379</span></span><br><span class=\"line\"><span class=\"attr\">remote_port</span> = <span class=\"number\">6379</span></span><br><span class=\"line\"><span class=\"attr\">use_encryption</span> = <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">use_compression</span> = <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<p><em>远程主机使用的是阿里云或者腾讯云等虚拟主机，要在安全组规则中放行端口</em></p>\n<h3 id=\"访问内网主机的web服务\">访问内网主机的web服务<a title=\"#访问内网主机的web服务\" href=\"#访问内网主机的web服务\"></a></h3>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[web]</span></span><br><span class=\"line\"><span class=\"attr\">type</span> = http</span><br><span class=\"line\">本地web服务IP地址和端口号</span><br><span class=\"line\"><span class=\"attr\">local_ip</span> = <span class=\"number\">127.0</span>.<span class=\"number\">0.1</span></span><br><span class=\"line\"><span class=\"attr\">local_port</span> = <span class=\"number\">9000</span></span><br><span class=\"line\"><span class=\"comment\"># 域名要解析到服务端主机IP</span></span><br><span class=\"line\"><span class=\"attr\">custom_domains</span> = www.liyan.run</span><br></pre></td></tr></table></figure>\n<p>访问<code>www.liyan.run:80</code>可访问到内网中的9000端口服务。</p>\n<p><em>80端口是在服务端frps.ini中vhost_http_port配置。http默认端口号是80，访问时可省略</em></p>\n<h3 id=\"启动frpc\">启动frpc<a title=\"#启动frpc\" href=\"#启动frpc\"></a></h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">screen -S frpc ./frpc -c frpc.ini</span><br></pre></td></tr></table></figure>\n<h1 id=\"测试\">测试<a title=\"#测试\" href=\"#测试\"></a></h1>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh -p 6000 121.197.190.123</span><br></pre></td></tr></table></figure>\n<p>可以连接到内网主机，说明内网穿透成功。</p>\n<hr>\n<p>详细的文档：</p>\n<p>中文：<a href=\"https://gitee.com/dengweiwen/frp\" target=\"_blank\">https://gitee.com/dengweiwen/frp</a></p>\n<p>英文：<a href=\"https://github.com/fatedier/frp\" target=\"_blank\">https://github.com/fatedier/frp</a></p>\n","next":{"title":"Docker安装Jenkins","link":"2020/09/docker-install-jenkins"},"plink":"https://www.shiguangping.com/2020/10/frp-install/","toc":[{"id":"准备工作：","title":"准备工作：","index":"1"},{"id":"配置服务端（vps）","title":"配置服务端（VPS）","index":"2","children":[{"id":"下载frp","title":"下载Frp","index":"2.1"},{"id":"编辑frps.ini","title":"编辑frps.ini","index":"2.2"},{"id":"启动frps","title":"启动frps","index":"2.3"}]}]}